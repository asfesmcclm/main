<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Profesional UGT - Sandbox v4</title>
    <style>
        :root { 
            --ugt-red: #e30613; 
            --ugt-green: #166534; 
            --warning: #856404; 
            --bg-warning: #fff3cd; 
            --info-blue: #004085;
            --bg-info: #eef6ff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; padding: 15px; color: #333; }
        .container { max-width: 600px; margin: auto; }
        .card { background: white; padding: 22px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h3 { color: var(--ugt-red); margin-top: 0; font-size: 1.2rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 18px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.9rem; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .radio-group { display: flex; gap: 15px; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        .radio-group label { font-weight: normal; display: flex; align-items: center; gap: 5px; cursor: pointer; margin-bottom: 0; }
        
        /* Alertas y Feedback */
        .info-live { margin-top: 10px; padding: 10px; background: #f0fdf4; border: 1px dashed #bbf7d0; border-radius: 8px; font-size: 0.9rem; color: var(--ugt-green); display: none; }
        .alert-smi { background: var(--bg-warning); color: var(--warning); border: 1px solid #ffeeba; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.85rem; display: none; }
        .alert-high { background: var(--bg-info); color: var(--info-blue); border: 1px solid #b8daff; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.85rem; display: none; }
        
        button { background: var(--ugt-red); color: white; border: none; width: 100%; padding: 16px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        button:hover { background: #b3050f; }

        /* Estilos Informe */
        #resultado { display: none; margin-top: 25px; }
        .res-item { background: white; border-bottom: 1px solid #eee; padding: 15px; }
        .res-item:last-child { border-radius: 0 0 12px 12px; border-bottom: none; }
        .res-item:first-child { border-radius: 12px 12px 0 0; }
        .res-header { display: flex; justify-content: space-between; align-items: center; }
        .res-title { font-weight: bold; font-size: 0.95rem; max-width: 70%; }
        .res-value { font-weight: 800; color: var(--ugt-red); font-size: 1.1rem; }
        .msg-tramo { font-size: 0.75rem; color: #0056b3; font-weight: bold; margin-top: 4px; }
        .res-calc { font-size: 0.75rem; color: #777; margin-top: 3px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>1. Cronología Laboral</h3>
        <div class="form-group">
            <label>Fecha de inicio del contrato</label>
            <input type="date" id="f_inicio">
        </div>
        <div class="form-group">
            <label>Fecha de finalización / cese</label>
            <input type="date" id="f_fin">
        </div>
        <div id="info_antiguedad" class="info-live">Antigüedad detectada: <strong id="val_antiguedad">---</strong></div>
    </div>

    <div class="card">
        <h3>2. Percepciones Salariales</h3>
        <label>Tipo de salario bruto:</label>
        <div class="radio-group">
            <label><input type="radio" name="tipo_s" value="diario"> Diario</label>
            <label><input type="radio" name="tipo_s" value="mensual" checked> Mensual</label>
            <label><input type="radio" name="tipo_s" value="anual"> Anual</label>
        </div>

        <div class="form-group">
            <label>Importe Bruto (€)</label>
            <input type="text" id="s_importe" placeholder="Ej: 1850,50">
        </div>

        <div id="info_salario_anual" class="info-live">Salario bruto anual estimado: <strong id="val_salario_anual">---</strong></div>
        
        <div id="alert_smi" class="alert-smi">
            ⚠️ <strong>Aviso SMI:</strong> El salario detectado está por debajo del SMI 2026 (17.094 €). Si tu contrato es a jornada completa, consulta con el sindicato.
        </div>
        <div id="alert_high" class="alert-high">
            ℹ️ <strong>Verificación:</strong> El importe supera los 80.000 € anuales. ¿Es correcta la cantidad o necesitas revisarla?
        </div>
    </div>

    <button onclick="generarInforme()">GENERAR INFORME COMPARATIVO</button>

    <div id="resultado">
        <div id="lista_indemnizaciones" style="box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden;"></div>
    </div>
</div>

<script>
    const FECHA_REFORMA = new Date('2012-02-12');

    window.onload = function() {
        const hoy = new Date().toISOString().split('T')[0];
        document.getElementById('f_fin').value = hoy;
        document.getElementById('f_inicio').max = hoy; // Límite para no elegir fechas futuras
        
        document.getElementById('f_inicio').addEventListener('change', actualizar);
        document.getElementById('f_fin').addEventListener('change', actualizar);
        document.getElementById('s_importe').addEventListener('input', actualizar);
        document.querySelectorAll('input[name="tipo_s"]').forEach(r => r.addEventListener('change', actualizar));
    };

    function actualizar() {
        // Antigüedad
        const fi = new Date(document.getElementById('f_inicio').value);
        const ff = new Date(document.getElementById('f_fin').value);
        if (fi.getTime() && ff.getTime()) {
            const dias = Math.floor((ff - fi) / (1000 * 60 * 60 * 24));
            document.getElementById('val_antiguedad').innerText = dias >= 0 ? `${Math.floor(dias/365)} años y ${dias%365} días` : "Error en fechas";
            document.getElementById('info_antiguedad').style.display = 'block';
        }

        // Salario y Alertas
        let raw = document.getElementById('s_importe').value.replace(',', '.');
        const imp = parseFloat(raw) || 0;
        const tipo = document.querySelector('input[name="tipo_s"]:checked').value;
        if (imp > 0) {
            let anual = (tipo === 'diario') ? imp * 365 : (tipo === 'mensual' ? imp * 12 : imp);
            document.getElementById('val_salario_anual').innerText = anual.toLocaleString('es-ES', { style: 'currency', currency: 'EUR' });
            document.getElementById('info_salario_anual').style.display = 'block';
            
            // Gestión de avisos
            document.getElementById('alert_smi').style.display = anual < 17094 ? 'block' : 'none';
            document.getElementById('alert_high').style.display = anual > 80000 ? 'block' : 'none';
        } else {
            document.getElementById('info_salario_anual').style.display = 'none';
            document.getElementById('alert_smi').style.display = 'none';
            document.getElementById('alert_high').style.display = 'none';
        }
    }

    function calcularIndemPro(sDia, fIn, fOut) {
        if (fIn >= FECHA_REFORMA) {
            let anios = (fOut - fIn) / (1000 * 60 * 60 * 24 * 365.25);
            let total = sDia * 33 * anios;
            let tope = sDia * 30.42 * 24;
            return { valor: Math.min(total, tope), msg: "Cálculo: 33 días/año (Tope 24 mensualidades)" };
        } else {
            let diasT1 = (FECHA_REFORMA - fIn) / (1000 * 60 * 60 * 24);
            let diasT2 = (fOut - FECHA_REFORMA) / (1000 * 60 * 60 * 24);
            let indemT1 = sDia * 45 * (diasT1 / 365.25);
            let indemT2 = sDia * 33 * (diasT2 / 365.25);
            let total = indemT1 + indemT2;
            let tope24 = sDia * 30.42 * 24;
            let tope42 = sDia * 30.42 * 42;
            let final = (indemT1 > tope24) ? Math.min(total, tope42) : Math.min(total, tope24);
            return { valor: final, msg: "Incluye tramo de 45 días/año (anterior a feb-2012)" };
        }
    }

    function generarInforme() {
        const fi = new Date(document.getElementById('f_inicio').value);
        const ff = new Date(document.getElementById('f_fin').value);
        let raw = document.getElementById('s_importe').value.replace(',', '.');
        const imp = parseFloat(raw) || 0;
        if (!fi.getTime() || !ff.getTime() || imp <= 0) return alert("Completa los datos.");

        const tipo = document.querySelector('input[name="tipo_s"]:checked').value;
        const sAnual = (tipo === 'diario') ? imp * 365 : (tipo === 'mensual' ? imp * 12 : imp);
        const sDia = sAnual / 365;
        const aniosTotal = (ff - fi) / (1000 * 60 * 60 * 24 * 365.25);

        const resImp = calcularIndemPro(sDia, fi, ff);
        const totalObj = Math.min(sDia * 20 * aniosTotal, sDia * 30.42 * 12);
        const totalMSC = Math.min(sDia * 20 * aniosTotal, sDia * 30.42 * 9);
        const totalTemp = sDia * 12 * aniosTotal;

        let html = `
            <div class="res-item">
                <div class="res-header"><span class="res-title">1. DESPIDO IMPROCEDENTE</span><span class="res-value">${resImp.valor.toLocaleString('es-ES')} €</span></div>
                <div class="msg-tramo">${resImp.msg}</div>
            </div>
            <div class="res-item">
                <div class="res-header"><span class="res-title">2. DESPIDO OBJETIVO / ERE</span><span class="res-value">${totalObj.toLocaleString('es-ES')} €</span></div>
                <div class="res-calc">Cálculo: 20 días/año (Tope 12 mensualidades)</div>
            </div>
            <div class="res-item">
                <div class="res-header"><span class="res-title">3. MODIF. SUSTANCIAL CONDICIONES</span><span class="res-value">${totalMSC.toLocaleString('es-ES')} €</span></div>
                <div class="res-calc">Cálculo: 20 días/año (Tope 9 mensualidades)</div>
            </div>
            <div class="res-item">
                <div class="res-header"><span class="res-title">4. FIN CONTRATO TEMPORAL</span><span class="res-value">${totalTemp.toLocaleString('es-ES')} €</span></div>
                <div class="res-calc">Cálculo: 12 días/año (Sin tope mensual)</div>
            </div>
        `;
        
        document.getElementById('lista_indemnizaciones').innerHTML = html;
        document.getElementById('resultado').style.display = 'block';
        document.getElementById('resultado').scrollIntoView({ behavior: 'smooth' });
    }
</script>
</body>
</html>
