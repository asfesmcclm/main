<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Profesional UGT - v5 Garantía Legal</title>
    <style>
        :root { --ugt-red: #e30613; --ugt-green: #166534; --warning: #856404; --bg-warning: #fff3cd; }
        body { font-family: 'Segoe UI', sans-serif; background: #e9ecef; padding: 15px; color: #333; }
        .container { max-width: 600px; margin: auto; }
        .card { background: white; padding: 22px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h3 { color: var(--ugt-red); margin-top: 0; font-size: 1.2rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 18px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.9rem; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .radio-group { display: flex; gap: 15px; background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        .radio-group label { font-weight: normal; display: flex; align-items: center; gap: 5px; cursor: pointer; margin-bottom: 0; }
        .info-live { margin-top: 10px; padding: 10px; background: #f0fdf4; border: 1px dashed #bbf7d0; border-radius: 8px; font-size: 0.9rem; color: var(--ugt-green); display: none; }
        .alert-smi { background: var(--bg-warning); color: var(--warning); border: 1px solid #ffeeba; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.85rem; display: none; }
        
        /* Estilos Informe */
        #resultado { display: none; margin-top: 25px; }
        .res-item { background: white; border-bottom: 1px solid #eee; padding: 12px 15px; }
        .res-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .res-title { font-weight: bold; font-size: 0.9rem; color: #444; max-width: 75%; line-height: 1.2; }
        .res-value { font-weight: 800; color: var(--ugt-red); font-size: 1rem; white-space: nowrap; }
        .res-calc { font-size: 0.7rem; color: #888; margin-top: 2px; }
        .badge-fraude { color: #d94141; font-weight: bold; font-size: 0.7rem; display: block; margin-top: 3px; }
        
        button { background: var(--ugt-red); color: white; border: none; width: 100%; padding: 16px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>1. Cronología Laboral</h3>
        <div class="form-group">
            <label>Fecha de inicio</label>
            <input type="date" id="f_inicio">
        </div>
        <div class="form-group">
            <label>Fecha de cese</label>
            <input type="date" id="f_fin">
        </div>
        <div id="info_antiguedad" class="info-live">Antigüedad: <strong id="val_antiguedad">---</strong></div>
    </div>

    <div class="card">
        <h3>2. Salario</h3>
        <div class="radio-group">
            <label><input type="radio" name="tipo_s" value="diario"> Diario</label>
            <label><input type="radio" name="tipo_s" value="mensual" checked> Mensual</label>
            <label><input type="radio" name="tipo_s" value="anual"> Anual</label>
        </div>
        <input type="text" id="s_importe" placeholder="Ej: 1850,50">
        <div id="info_salario_anual" class="info-live">Salario Anual Bruto: <strong id="val_salario_anual">---</strong></div>
        <div id="alert_smi" class="alert-smi">⚠️ <strong>Aviso:</strong> Por debajo del SMI 2026. Revisa tu jornada.</div>
    </div>

    <button onclick="generarInforme()">GENERAR INFORME DETALLADO</button>

    <div id="resultado">
        <h3 style="text-align: center; color: #333; font-size: 1rem;">Cuantías por Modalidad de Extinción</h3>
        <div id="lista_indemnizaciones" style="box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden;"></div>
    </div>
</div>

<script>
    const REFORMA = new Date('2012-02-12');

    window.onload = function() {
        const hoy = new Date().toISOString().split('T')[0];
        document.getElementById('f_fin').value = hoy;
        document.getElementById('f_inicio').max = hoy;
        ['f_inicio','f_fin','s_importe'].forEach(id => document.getElementById(id).addEventListener('input', actualizar));
        document.querySelectorAll('input[name="tipo_s"]').forEach(r => r.addEventListener('change', actualizar));
    };

    function actualizar() {
        const fi = new Date(document.getElementById('f_inicio').value);
        const ff = new Date(document.getElementById('f_fin').value);
        if (fi.getTime() && ff.getTime()) {
            const dias = Math.floor((ff - fi) / (1000 * 60 * 60 * 24));
            document.getElementById('val_antiguedad').innerText = dias >= 0 ? `${Math.floor(dias/365)} años y ${dias%365} días` : "Error";
            document.getElementById('info_antiguedad').style.display = 'block';
        }
        let raw = document.getElementById('s_importe').value.replace(',', '.');
        const imp = parseFloat(raw) || 0;
        const tipo = document.querySelector('input[name="tipo_s"]:checked').value;
        if (imp > 0) {
            let anual = (tipo === 'diario') ? imp * 365 : (tipo === 'mensual' ? imp * 12 : imp);
            document.getElementById('val_salario_anual').innerText = anual.toLocaleString('es-ES', { style: 'currency', currency: 'EUR' });
            document.getElementById('info_salario_anual').style.display = 'block';
            document.getElementById('alert_smi').style.display = anual < 17094 ? 'block' : 'none';
        }
    }

    function calcular(sDia, sMes, fi, ff, diasAnio, topeMeses, esTemporal = false) {
        let aniosTotal = (ff - fi) / (1000 * 60 * 60 * 24 * 365.25);
        let valor, msg_calc;

        if (diasAnio === 33 && fi < REFORMA) {
            // Lógica Doble Tramo para 33 días
            let diasT1 = (REFORMA - fi) / (1000 * 60 * 60 * 24);
            let diasT2 = (ff - REFORMA) / (1000 * 60 * 60 * 24);
            let t1 = sDia * 45 * (diasT1 / 365.25);
            let t2 = sDia * 33 * (diasT2 / 365.25);
            valor = t1 + t2;
            let tope24 = sMes * 24;
            let tope42 = sMes * 42;
            let topeFinal = (t1 > tope24) ? tope42 : tope24;
            if (valor > topeFinal) { valor = topeFinal; msg_calc = "Tope legal alcanzado"; }
            else { msg_calc = "Cálculo tramos 45/33 días"; }
        } else {
            // Cálculo Lineal con Limpieza de decimales
            valor = sDia * diasAnio * aniosTotal;
            let tope = sMes * topeMeses;
            if (tope > 0 && valor > tope) { valor = tope; msg_calc = "Tope legal alcanzado"; }
            else { msg_calc = `${diasAnio} días/año`; }
        }
        
        let fraude = (esTemporal && aniosTotal > 3) ? "⚠️ Posible fraude de ley por duración" : "";
        return { v: valor.toFixed(2), m: msg_calc, f: fraude };
    }

    function generarInforme() {
        const fi = new Date(document.getElementById('f_inicio').value);
        const ff = new Date(document.getElementById('f_fin').value);
        let raw = document.getElementById('s_importe').value.replace(',', '.');
        const imp = parseFloat(raw) || 0;
        const tipo = document.querySelector('input[name="tipo_s"]:checked').value;
        if (!fi.getTime() || !ff.getTime() || imp <= 0) return alert("Datos incompletos");

        let sAnual = (tipo === 'diario') ? imp * 365 : (tipo === 'mensual' ? imp * 12 : imp);
        let sMes = sAnual / 12;
        let sDia = sAnual / 365;

        const casos = [
            { n: "1. DESPIDO IMPROCEDENTE", d: 33, t: 24 },
            { n: "2. VOLUNTAD TRABAJADOR (INCUMPLIMIENTO)", d: 33, t: 24 },
            { n: "3. DESPIDO OBJETIVO PROCEDENTE", d: 20, t: 12 },
            { n: "4. DESPIDO COLECTIVO PROCEDENTE", d: 20, t: 12 },
            { n: "5. MOVILIDAD GEOGRÁFICA", d: 20, t: 12 },
            { n: "6. MODIFICACIÓN SUSTANCIAL CONDICIONES", d: 20, t: 9 },
            { n: "7. VÍCTIMAS VIOLENCIA / TERRORISMO", d: 20, t: 12 },
            { n: "8. EXTINCIÓN CONTRATO TEMPORAL", d: 12, t: 0, tmp: true }
        ];

        let html = "";
        casos.forEach(c => {
            let r = calcular(sDia, sMes, fi, ff, c.d, c.t, c.tmp);
            html += `<div class="res-item">
                <div class="res-header"><span class="res-title">${c.n}</span><span class="res-value">${Number(r.v).toLocaleString('es-ES')} €</span></div>
                <div class="res-calc">${r.m}</div>
                ${r.f ? `<span class="badge-fraude">${r.f}</span>` : ''}
            </div>`;
        });
        document.getElementById('lista_indemnizaciones').innerHTML = html;
        document.getElementById('resultado').style.display = 'block';
    }
</script>
</body>
</html>
