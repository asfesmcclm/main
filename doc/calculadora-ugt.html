<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Finiquito Profesional - UGT</title>
    <link rel="stylesheet" href="css/estilos.css">
    <style>
        :root { --ugt-red: #e30613; --ugt-green: #28a745; --bg: #f4f4f4; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 650px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        h2, h3 { color: var(--ugt-red); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .btn-main { background: var(--ugt-green); color: white; border: none; width: 100%; padding: 18px; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-main:hover { background: #218838; transform: translateY(-2px); }
        .alert-smi { background: #fff3cd; color: #856404; padding: 12px; border-radius: 6px; border-left: 5px solid #ffeeba; margin-top: 10px; font-size: 0.85rem; }
        .res-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .total-box { background: #333; color: white; padding: 15px; border-radius: 8px; margin-top: 20px; display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; }
        .btn-close { position: absolute; top: 15px; right: 15px; background: #eee; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 12px; line-height: 25px; text-align: center; font-weight: bold; }
        small { color: #666; font-size: 0.75rem; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 25px;">
        <h2 style="border:none; margin-bottom: 5px;">Cálculo de Finiquito</h2>
        <p style="color:#666; font-size:0.9rem;">Liquidación técnica de haberes (Normativa 2026)</p>
    </div>

    <div class="card">
        <h3>1. Datos Salariales</h3>
        <div class="form-group">
            <label>Importe Bruto (€)</label>
            <input type="number" id="f_s_importe" placeholder="Ej: 1800" oninput="validarSMIFiniquito()">
            <div id="info_anual" style="font-size:0.8rem; color:#666; margin-top:5px; font-style:italic;"></div>
            <div id="alert_smi" class="alert-smi" style="display:none;">
                ⚠️ El salario anual es inferior al SMI 2026 (17.094 €).
            </div>
        </div>
        <div class="form-group">
            <label>Periodicidad del importe</label>
            <select id="f_s_tipo" onchange="validarSMIFiniquito()">
                <option value="mensual">Mensual</option>
                <option value="anual">Anual</option>
                <option value="diario">Diario</option>
            </select>
            <small>Recuerda: Incluye el prorrateo de pagas extras si las cobras mes a mes.</small>
        </div>
    </div>

    <div class="card">
        <h3>2. Periodos a Liquidar</h3>
        <div class="form-group">
            <label>Inicio del devengo (Vacaciones/Extras)</label>
            <input type="date" id="f_inicio_devengo">
            <small>Fecha en la que empezaste a acumular vacaciones (normalmente 1 de enero o fecha de alta).</small>
        </div>
        <div class="form-group">
            <label>Fecha de cese o fin de contrato</label>
            <input type="date" id="f_cese">
            <small>Tu último día de trabajo efectivo.</small>
        </div>
    </div>

    <div class="card">
        <h3>3. Parámetros del Convenio</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
                <label>Días vacaciones/año</label>
                <input type="number" id="f_vac_convenio" value="30">
            </div>
            <div class="form-group">
                <label>Días ya disfrutados</label>
                <input type="number" id="f_vac_disfrutadas" value="0">
            </div>
        </div>
        <div class="form-group">
            <label>Número de pagas extras anuales</label>
            <input type="number" id="f_num_pagas" value="2">
            <small>Indica cuántas pagas "aparte" tienes (Navidad, Verano, Marzo...)</small>
        </div>
        <div class="form-group">
            <label>¿Pagas extras prorrateadas?</label>
            <select id="f_pagas_pro">
                <option value="no">No (Las cobro en meses específicos)</option>
                <option value="si">Sí (Ya incluidas en el salario mensual)</option>
            </select>
        </div>
    </div>

    <button class="btn-main" onclick="ejecutarCalculoFiniquito()">GENERAR LIQUIDACIÓN DETALLADA</button>

    <div id="f_resultado_area" class="card" style="display:none; margin-top: 30px; padding:0; overflow:hidden;">
        <div style="background:var(--ugt-green); color:white; padding:15px; text-align:center; font-weight:bold;">
            RESULTADO DE LA LIQUIDACIÓN (BRUTO)
        </div>
        <div style="padding:20px;">
            <div id="f_detalle_lista"></div>
            <div class="total-box">
                <span>TOTAL A PERCIBIR:</span>
                <span id="f_total_final"></span>
            </div>
        </div>
    </div>

    <div id="seccion_hacienda" class="card" style="margin-top:20px; background:#fff9f9; border-top: 4px solid #ffc107;">
        <button class="btn-close" onclick="this.parentElement.style.display='none'">x</button>
        <h3 style="font-size:1rem; color:#856404;">Aviso sobre Tributación</h3>
        <p id="txt_hacienda" style="font-size:0.85rem; color:#555;"></p>
    </div>
</div>

<script src="js-calculadora/ui.js"></script>
<script>
    window.onload = function() {
        if (typeof UI !== 'undefined') {
            document.getElementById('txt_hacienda').innerHTML = UI.textos.haciendaInfo;
        }
        // Fechas por defecto
        const hoy = new Date().toISOString().split('T')[0];
        const inicioAnio = new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0];
        document.getElementById('f_inicio_devengo').value = inicioAnio;
        document.getElementById('f_cese').value = hoy;
    };

    function validarSMIFiniquito() {
        const imp = parseFloat(document.getElementById('f_s_importe').value) || 0;
        const tipo = document.getElementById('f_s_tipo').value;
        let anual = imp;
        if(tipo === 'mensual') anual = imp * 12;
        if(tipo === 'diario') anual = imp * 365;

        const info = document.getElementById('info_anual');
        const alertSmi = document.getElementById('alert_smi');
        
        if (anual > 0) {
            info.innerText = "Salario bruto anual calculado: " + anual.toLocaleString('de-DE') + " €";
            alertSmi.style.display = (anual < 17094) ? 'block' : 'none';
        } else {
            info.innerText = "";
            alertSmi.style.display = 'none';
        }
        return { anual, sDia: anual/365, sMes: anual/12 };
    }

    function ejecutarCalculoFiniquito() {
        const salarios = validarSMIFiniquito();
        const f1 = new Date(document.getElementById('f_inicio_devengo').value);
        const f2 = new Date(document.getElementById('f_cese').value);
        
        if (isNaN(f1) || isNaN(f2) || f1 > f2) {
            alert("Las fechas son incorrectas."); return;
        }

        // 1. Días de devengo acumulados
        const diasDevengo = Math.floor((f2 - f1) / (1000*60*60*24)) + 1;

        // 2. Cálculo Vacaciones (Regla de proporcionalidad)
        const vacConvenio = parseFloat(document.getElementById('f_vac_convenio').value) || 30;
        const vacDisfrutadas = parseFloat(document.getElementById('f_vac_disfrutadas').value) || 0;
        const diasGenerados = (vacConvenio / 365) * diasDevengo;
        const diasPendientes = diasGenerados - vacDisfrutadas;
        const impVac = diasPendientes * salarios.sDia;

        // 3. Cálculo Pagas Extras (Estimación por devengo en el año)
        let impExtras = 0;
        const nPagas = parseFloat(document.getElementById('f_num_pagas').value) || 2;
        if (document.getElementById('f_pagas_pro').value === 'no') {
            const valorPaga = salarios.sAnual / (12 + nPagas);
            // Cálculo proporcional semestral (aproximado a días de devengo)
            impExtras = (valorPaga / 182) * (diasDevengo % 182); 
        }

        // 4. Salario de los días trabajados en el último mes
        const diasUltimoMes = f2.getDate();
        const impUltimoMes = salarios.sDia * diasUltimoMes;

        // RENDERIZADO
        const lista = document.getElementById('f_detalle_lista');
        lista.innerHTML = `
            <div class="res-item"><span>Días trabajados mes del cese (${diasUltimoMes} días):</span> <strong>${impUltimoMes.toLocaleString('de-DE', {minimumFractionDigits:2})} €</strong></div>
            <div class="res-item"><span>Vacaciones no disfrutadas (${diasPendientes.toFixed(2)} días):</span> <strong>${Math.max(0, impVac).toLocaleString('de-DE', {minimumFractionDigits:2})} €</strong></div>
            ${impExtras > 0 ? `<div class="res-item"><span>Proporcional Pagas Extras:</span> <strong>${impExtras.toLocaleString('de-DE', {minimumFractionDigits:2})} €</strong></div>` : ''}
        `;
        
        const total = impUltimoMes + Math.max(0, impVac) + impExtras;
        document.getElementById('f_total_final').innerText = total.toLocaleString('de-DE', {minimumFractionDigits:2}) + " €";
        document.getElementById('f_resultado_area').style.display = 'block';
        document.getElementById('f_resultado_area').scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
