<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Despido Profesional - UGT</title>
    <style>
        /* ESTILOS DE MARCA UGT */
        :root { --ugt-red: #e30613; --text: #333; --bg: #f4f4f4; --blue-info: #17a2b8; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; }
        .container { max-width: 650px; margin: auto; }
        
        /* TARJETAS Y SECCIONES */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        h2, h3 { color: var(--ugt-red); margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        /* BOTÓN DE CIERRE (X) */
        .btn-close { position: absolute; top: 15px; right: 15px; background: #eee; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-weight: bold; color: #666; font-size: 12px; line-height: 25px; text-align: center; }
        .btn-close:hover { background: #ddd; color: #000; }

        /* FORMULARIO */
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input[type="date"], input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .radio-group { display: flex; gap: 15px; background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px solid #eee; }
        
        /* ALERTAS */
        .alert { padding: 12px; border-radius: 6px; margin-top: 10px; font-size: 0.85rem; display: none; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        /* BOTÓN CALCULAR */
        .btn-main { background: var(--ugt-red); color: white; border: none; width: 100%; padding: 18px; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-main:hover { background: #b3050f; transform: translateY(-2px); }

        /* RESULTADOS */
        #resultado { display: none; padding: 0; overflow: hidden; }
        .res-item { background: white; border-bottom: 1px solid #eee; padding: 15px; transition: background 0.2s; }
        .res-item:hover { background: #fffafb; }
        .res-item:last-child { border-bottom: none; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 25px;">
        <h2 style="margin-bottom: 5px; border:none;">Calculadora de Indemnizaciones</h2>
        <p style="font-size: 0.9rem; color: #666;">Basada en la normativa vigente 2026</p>
    </div>

    <div class="card">
        <h3>1. Cronología Laboral</h3>
        <div class="form-group">
            <label>Fecha de inicio del contrato</label>
            <input type="date" id="f_inicio">
        </div>
        <div class="form-group">
            <label>Fecha de cese o despido</label>
            <input type="date" id="f_fin">
        </div>
        
        <div id="info_antiguedad" class="alert alert-info" style="border-left: 4px solid var(--blue-info);">
            <span id="val_antiguedad"></span>
        </div>
    </div>

    <div class="card">
        <h3>2. Salario y Jornada</h3>
        <p id="ayuda_salario" style="font-size: 0.8rem; background: #f0f7ff; padding: 12px; border-radius: 6px; border-left: 4px solid #007bff; margin-bottom: 20px;"></p>
        
        <div class="form-group">
            <label>Periodicidad del importe bruto</label>
            <div class="radio-group">
                <label><input type="radio" name="tipo_s" value="diario"> Diario</label>
                <label><input type="radio" name="tipo_s" value="mensual" checked> Mensual</label>
                <label><input type="radio" name="tipo_s" value="anual"> Anual</label>
            </div>
        </div>

        <div class="form-group">
            <label>Importe Bruto (€)</label>
            <input type="text" id="s_importe" placeholder="Ej: 1950.75">
        </div>

        <div id="alert_smi" class="alert alert-warning"></div>
        <div id="alert_high" class="alert alert-info"></div>
    </div>

    <button class="btn-main" onclick="ejecutarCalculo()">GENERAR INFORME DETALLADO</button>

    <div id="aviso_exclusiones" class="card" style="display:none; border-left: 4px solid #666; background: #f9f9f9; margin-top: 30px;">
        <button class="btn-close" onclick="UI.cerrarSeccion('aviso_exclusiones')">X</button>
        <div id="texto_exclusiones" style="font-size: 0.85rem; color: #444;"></div>
    </div>

    <div id="resultado" class="card" style="padding: 0; overflow: hidden; margin-top: 10px;">
        <div style="background: #333; color: white; padding: 12px; text-align: center; font-weight: bold; font-size: 0.9rem;">
            CUANTÍAS ESTIMADAS POR TIPO DE EXTINCIÓN
        </div>
        <div id="lista_indemnizaciones"></div>
    </div>

    <div id="seccion_hacienda" class="card" style="margin-top: 40px; border-top: 4px solid #ffc107;">
        <button class="btn-close" onclick="UI.cerrarSeccion('seccion_hacienda')">X</button>
        <h3 style="color: #856404; font-size: 1rem;">Tributación (I.R.P.F.)</h3>
        <p style="font-size: 0.85rem; color: #555;"></p>
    </div>

    <div id="seccion_seguro" class="card" style="border-top: 4px solid #28a745;">
        <button class="btn-close" onclick="UI.cerrarSeccion('seccion_seguro')">X</button>
        <h3 style="color: #155724; font-size: 1rem;">Cotización a la S.S.</h3>
        <p style="font-size: 0.85rem; color: #555;"></p>
    </div>
</div>

<script src="js-calculadora/config.js"></script>
<script src="js-calculadora/logic.js"></script>
<script src="js-calculadora/ui.js"></script>

<script>
    window.onload = function() {
        // 1. Configuración de fechas por defecto
        const hoy = new Date().toISOString().split('T')[0];
        const fFinInput = document.getElementById('f_fin');
        const fIniInput = document.getElementById('f_inicio');
        if (fFinInput) fFinInput.value = hoy;
        if (fIniInput) fIniInput.max = hoy;
        
        // 2. Inyección de textos iniciales desde ui.js
        try {
            if (typeof UI !== 'undefined') {
                document.getElementById('ayuda_salario').innerHTML = UI.textos.ayudaSalario;
                document.getElementById('alert_smi').innerText = UI.textos.smiAviso;
                document.getElementById('alert_high').innerText = UI.textos.altoAviso;
                
                const pHacienda = document.querySelector('#seccion_hacienda p');
                if (pHacienda) pHacienda.innerHTML = UI.textos.haciendaInfo;
                
                const pSeguro = document.querySelector('#seccion_seguro p');
                if (pSeguro) pSeguro.innerHTML = UI.textos.ssInfo;
            }
        } catch (e) {
            console.error("Error al cargar textos de UI:", e);
        }

        // 3. VALIDACIÓN INICIAL DE LÍMITES (SMI)
        // Esto hace que si ya hay un valor, la alerta aparezca al cargar
        validarLimitesSalariales();

        // 4. Vigilante de antigüedad automático
        document.querySelectorAll('#f_inicio, #f_fin').forEach(el => {
            el.addEventListener('change', () => {
                const f1Val = document.getElementById('f_inicio').value;
                const f2Val = document.getElementById('f_fin').value;
                if (f1Val && f2Val && typeof MotorCalculo !== 'undefined') {
                    const f1 = new Date(f1Val);
                    const f2 = new Date(f2Val);
                    if (f1 <= f2) {
                        const antiguedad = MotorCalculo.obtenerAntiguedadDetallada(f1, f2);
                        UI.mostrarAntiguedad(antiguedad);
                    }
                }
            });
        });
    };

    // FUNCIÓN: Valida SMI y Salario Alto en tiempo real
    function validarLimitesSalariales() {
        const input = document.getElementById('s_importe');
        const alertSmi = document.getElementById('alert_smi');
        const alertHigh = document.getElementById('alert_high');
        
        if (!input || !alertSmi || typeof CONFIG_LEGAL === 'undefined') return;

        const val = parseFloat(input.value.replace(',', '.')) || 0;
        const radio = document.querySelector('input[name="tipo_s"]:checked');
        const tipo = radio ? radio.value : 'mensual';
        
        let anual = 0;
        if (tipo === 'diario') anual = val * 365;
        else if (tipo === 'mensual') anual = val * 12;
        else anual = val;

        // Mostrar/Ocultar alertas según límites de config.js
        if (anual > 0 && anual < CONFIG_LEGAL.parametros_legales.smi_anual_2026) {
            alertSmi.style.display = 'block';
        } else {
            alertSmi.style.display = 'none';
        }

        if (anual > CONFIG_LEGAL.parametros_legales.umbral_salario_alto) {
            alertHigh.style.display = 'block';
        } else {
            alertHigh.style.display = 'none';
        }
    }

    // Escuchadores para cambios en el salario
    document.getElementById('s_importe').addEventListener('input', validarLimitesSalariales);
    document.querySelectorAll('input[name="tipo_s"]').forEach(r => {
        r.addEventListener('change', validarLimitesSalariales);
    });

    // FUNCIÓN: Ejecuta el cálculo al pulsar el botón
    function ejecutarCalculo() {
        const fIniVal = document.getElementById('f_inicio').value;
        const fFinVal = document.getElementById('f_fin').value;
        const impRaw = document.getElementById('s_importe').value.replace(',', '.');
        const radioChecked = document.querySelector('input[name="tipo_s"]:checked');

        if (!fIniVal || !fFinVal || !impRaw || isNaN(impRaw)) {
            alert("Por favor, introduce una fecha válida y un salario bruto correcto.");
            return;
        }

        const fIni = new Date(fIniVal);
        const fFin = new Date(fFinVal);
        const tipo = radioChecked ? radioChecked.value : 'mensual';

        let anual = parseFloat(impRaw);
        if (tipo === 'diario') anual *= 365;
        if (tipo === 'mensual') anual *= 12;

        const datos = {
            fInicio: fIni,
            fFin: fFin,
            sDia: anual / 365,
            sMes: anual / 12
        };

        if (typeof MotorCalculo !== 'undefined') {
            const informe = MotorCalculo.generarInformeCompleto(CONFIG_LEGAL, datos);
            renderizarTodo(informe);
        }
    }

    // FUNCIÓN: Dibuja los resultados en pantalla
    function renderizarTodo(informe) {
        // 1. Mostrar Bloque de Exclusiones
        const avisoEx = document.getElementById('aviso_exclusiones');
        const textoEx = document.getElementById('texto_exclusiones');
        if (avisoEx && textoEx) {
            textoEx.innerHTML = UI.textos.exclusionIndemnizacion;
            avisoEx.style.display = 'block';
        }

        // 2. Renderizar lista de indemnizaciones
        let html = "";
        informe.forEach(item => {
            html += `
                <div class="res-item">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <span style="font-weight:bold; font-size:0.9rem; max-width:70%;">${item.nombre}</span>
                        <span style="color:var(--ugt-red); font-weight:800; font-size:1rem;">${UI.formatEuro(item.importe)}</span>
                    </div>
                    <div style="font-size:0.75rem; color:#666; margin-top:4px;">${item.descripcion}</div>
                    <div style="font-size:0.7rem; color:#0056b3; font-style:italic;">Fórmula: ${item.formula_aplicada}</div>
                    ${item.alerta ? `<div style="color:#d94141; font-weight:bold; font-size:0.75rem; margin-top:6px;">${item.alerta}</div>` : ''}
                </div>`;
        });
        
        const listaDiv = document.getElementById('lista_indemnizaciones');
        const resDiv = document.getElementById('resultado');
        if (listaDiv && resDiv) {
            listaDiv.innerHTML = html;
            resDiv.style.display = 'block';
            avisoEx.scrollIntoView({ behavior: 'smooth' });
        }
    }
</script>    
</body>
</html>
